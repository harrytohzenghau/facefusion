<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="#">
    <title>Display API Response</title>
</head>
<body>

    <h1>API Response:</h1>
    <p id="api-response">Loading...</p>
    <label>Enter Etch Depth</label>
    <input type="text" name="etch-depth">

    <label>Enter Width</label>
    <input type="text" name="width">

    <script>
        url = 'https://c8db-138-75-118-40.ngrok-free.app'
        async function fetchData() {
            try {
                // Replace 'your-endpoint-url' with the actual endpoint URL
                const response = await fetch(`${url}/`,{
                    method: "GET",
                    headers:{
                        'ngrok-skip-browser-warning': 'true'
                    }
                });
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.text(); // Assuming the endpoint returns a string
                document.getElementById('api-response').innerText = data;
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('api-response').innerText = "Error loading data.";
            }
        }

        // Call the async function to fetch data
        fetchData();
    </script>
    <h1>Download Video File</h1>

    <!-- Button to trigger the download -->
    <button id="downloadBtn">Download Video</button>

    <script>
        // The URL of the video file from the backend API
        const videoUrl = `${url}/get-hd`; // Replace with your endpoint

        async function downloadVideo() {
            try {
                // Fetch the video file from the endpoint
                const response = await fetch(videoUrl, {
                    method: "GET",
                    headers:{
                        'ngrok-skip-browser-warning': 'true'
                    }
                });

                // Convert response to a blob
                const blob = await response.blob();

                // Create a URL for the blob
                const url = window.URL.createObjectURL(blob);
                console.log(url)

                // Create an anchor element and simulate a click to download the file
                const a = document.createElement('a');
                a.href = url;
                a.download = 'processed_video.mov'; // The filename for the downloaded file
                document.body.appendChild(a);
                a.click();

                // Clean up
                a.remove();
                window.URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Error downloading the video:', error);
            }
        }

        // Add event listener to the button
        document.getElementById('downloadBtn').addEventListener('click', downloadVideo);
    </script>



    <p id="idk"></p>
    <button onclick="getWhat()">what</button>
    <script>
        async function getWhat(){
            const response = await fetch(`${url}/`,{
                headers:{
                    'ngrok-skip-browser-warning': 'true'
                }
            })
            const data = await response.text()
            document.getElementById("idk").innerText = data
        }


    </script>

    <h1>Upload Video for Processing</h1>
    <form id="upload-form" method="post" enctype="multipart/form-data">
        <label for="video">Choose video file:</label>
        <input type="file" id="video" name="file" accept="video/*" required>
        <br><br>
        <button type="submit">Upload and Process</button>
    </form>

    <p id="download-link"></p>

    <script>
        const form = document.getElementById('upload-form');
        form.action = `${url}/make-hd`
        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            const formData = new FormData(form);

            const response = await fetch(`${url}/make-hd`, {
                method: 'POST',
                body: formData
            });

            if (response.ok) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'processed_video.mp4';
                document.getElementById('download-link').appendChild(link);
                link.textContent = 'Download Processed Video';
            } else {
                alert('Error processing video');
            }
        });
    </script>


</body>
</html>
